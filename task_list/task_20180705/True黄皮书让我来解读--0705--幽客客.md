# True黄皮书让我来解读

## 首先我们来看初链的定义:高性能去中心化公开账本,从这里我们可以解读出True大体在做什么，以下我们主要从它的定义来解读:

### 理解高性能

- 首先我们先来看一个技术定义 TPS:（每秒交易处理量），再来看看True的最大处理量，这一点在白皮书上可以看到True的TPS为10000-100000,也就是说在理解最优的情况之下TPS为10万。那么10万到底是什么级别？

- 下面我们根据横向与纵向对比看看这样的处理量到底高不高：

- 1. 横向对比：比特币处理速度:7TPS,True的处理速度为比特币的14286倍;以太坊处理速度:20TPS,True的处理速度为以太坊的5000倍
- 2. 纵向对比：PayPal处理速度:193TPS,True的处理速度为PayPal的518倍;Visa处理速度:1,667TPS,True的处理速度为PayPal的60倍

- 以上可见，True标称的处理速度可以说是高性能，10万TPS基本可以处理实际应用场景中的所有问题，但是是不是能解决所有问题呢，对比支付宝2017双11峰值：25.6万TPS，说明要处理大规模的并发还需要再优化处理速度。

- 那么True是如何做到高性能呢，这里我们就来说说True的核心混合共识算法POW+PBFT:True在这方面的思路颇具创意：其采用PBFT在上，POW在下，两个账本同时运行的方式弥补任何单一共识机制的劣势。POW运行速度慢，作为slowchain，不负责更新账本；PBFT效率高，作为fastchain，主要负责记录交易。

- 下面我们用一张图来分析主算法PBFT为什么会快，有哪些问题，为什么要用POW混合？

- ![Image text](https://upload-images.jianshu.io/upload_images/13147174-98e54c63602a4006.JPEG?imageMogr2/auto-orient/strip%7CimageView2/2/w/554)

- 其中C为发送请求端，0123为服务端，3为宕机的服务端，具体步骤如下：

-  1. Request：请求端C发送请求到任意一节点，这里是0
-  2. Pre-Prepare：服务端0收到C的请求后进行广播，扩散至123
-  3. Prepare：123,收到后记录并再次广播，1->023，2->013，3因为宕机无法广播
-  4. Commit：0123节点在Prepare阶段，若收到超过一定数量的相同请求，则进入Commit阶段，广播Commit请求
-  5. Reply：0123节点在Commit阶段，若收到超过一定数量的相同请求，则对C进行反馈

- 由上图我们可以看出 PBFT 算法可以允许1/3的的主机宕机、腐败、作恶都不会出问题，我们知道，速度影响者永远是最慢方，所以最慢的就是速度，在我们只考虑前2/3的速度的情况下，性能肯定会大大提升.那么超过1/3的记账人主机出现问题怎么办？

- 1. 当有1/3或以上记账人停止工作后，系统将无法提供服务；
- 2. 当有1/3或以上记账人联合作恶，且其它所有的记账人被恰好分割为两个网络孤岛时，恶意记账人可以使系统出现分叉，但是会留下密码学证据

- 如何避免以上这两种情况呢? 这里就要回答上面的问题：为什么要用POW混合？
- PBFT的节点从POW的节点中选出，同时建立淘汰机制：任何超出安全边际，即超时、做假账或有偏向性记录的节点都将被淘汰。而这种淘汰机制的运行，运用POW来实现。这样就完全避免了1/3节点记账人宕机、腐败、作恶。而True要面临的问题就是如何保证slowchain pow会在宕机、腐败、作恶的记账人节点达到达1/3以前把它有效的剔除。

### 理解去中心化
- 去中心化的根本就是没有中心主机，True 通过Pow算法去筛选记账人的方法，严格来说有一些趋中心化,与比特币pow算法完全无中心的方案还是有一定的中心化，但是为了达到处理速度而选用超级节点、代理人，是目前最有效的方法。并且代理人用算法快速更替，也是一种很好的解决方案。

### 理解公开账本
-  公开账本其实就是True的目标，做一个公链。发展自己的Dapp生态，未来谁的Dapp多，谁就是王者，而不是谁发币多。Dapp可以解决许多现实中的问题：你喝的牛奶的牛，从出生到产下你这杯奶有得过什么病，注射过什么一秒，你所捐的钱是进入了需要人的手里还是被人劫持了。这里就不一一列举。Dapp生态是通往成功的最后一步。

## True做的一些创新

### fPOW
- 根据白皮书的描述：fPoW 是一种全新的设计挖矿设计理念，初链采用了水果链（FruitChain）的设计，
在挖矿过程中保证所有参与者的公平性。在挖矿过程中，PBFT 生产大区块，而水果链负责将大区块分成若干个水果，
这些水果具有保鲜期，每个水果中记录了若干条交易信息，普通挖矿只用验证这些交易信息即可，并不需要投入大量的挖矿设备、
电力和带宽，水果链的轻节点设计理念，可以让普通参与者使用普通的计算机，甚至于使用手机就能实现挖矿。

- 结合黄皮书我们可以看出fPOW的优点：

- 1. fruitchain的分片机制，单机和矿池可以获得近似的收益
- 2. 矿物果实以任何顺序开采，可以并行开采
- 3. 写块后才会稳定，防止算力浪费
- 4. 公平可靠，解决Pow中存在的 25%攻击，大矿池联合挖矿、交易费不稳定的问题


### 结合ipfs的分级存储级别：

- 好的存储级别和合理的费用有助于Dapp的发发展，通过黄皮书我们不难看出True做出的努力

- 1. 存储在每个节点上的（支付燃气费）
- 2. 存储在结合了ipfs中心存储节点的(存储和检索费)
- 3. 个人本地节点（免费）

### 结合了EVM的融合POW、PBFT的TVM

- 1. 结合EVM规范、权限化、采用Keccak-256哈希算法、椭圆曲线加密（ECC）算法、栈式架构
- 2. 可在POW PBFT之间自由切换
- 3. 进程序互通、适合dailyBFT

## 总结

 通过研读初链的黄皮书，让我看到了一个领先并可靠的公链解决方案。目前公链最大的瓶颈在于处理速度，
 现有最成熟的以太防处理20TPS，只能用来发发币，和处理不了即时的事物，当如支付等需要实时结果的方案时已经不能解决，
 当代币批量交易的时候连自己的交易都要延迟半小时甚至几小时， 以太防Casper和分片要达到几千TPS，无疑比True的低档1万TPS还要少，但是两者生态不是一个级别，
 相信有了处理速度的True，生态也会不会差。True已经在混合的前端，希望一直在前面走下去，创出一条路。

